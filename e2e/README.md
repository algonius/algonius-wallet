# E2E 自动化测试

本目录包含 Algonius Wallet 的端到端 (E2E) 自动化测试，基于 Playwright 框架实现。

## 项目结构

```
e2e/
├── tests/              # 测试用例
│   └── wallet-import.spec.ts  # 钱包导入测试
├── fixtures/           # 测试夹具
│   └── extension.ts    # Chrome 扩展测试配置
├── utils/              # 工具函数
│   └── test-data.ts    # 测试数据
└── README.md           # 说明文档
```

## 运行测试

### 本地开发环境

1. **安装依赖**
   ```bash
   npm install
   ```

2. **构建扩展**
   ```bash
   npm run build
   ```

3. **运行 E2E 测试**
   ```bash
   npm run test:e2e
   ```

4. **使用 UI 模式运行测试**
   ```bash
   npm run test:e2e:ui
   ```

### CI 环境

测试已集成到 GitHub Actions 中，会在以下情况自动运行：
- Push 到 main 分支
- 创建 Pull Request

## 测试用例

### 钱包导入场景测试 (`wallet-import.spec.ts`)

覆盖以下功能：

1. **通过助记词导入钱包**
   - 打开扩展弹窗
   - 选择助记词导入
   - 输入有效助记词
   - 设置钱包密码
   - 验证导入成功

2. **通过私钥导入钱包**
   - 选择私钥导入方式
   - 输入有效私钥
   - 验证导入成功

3. **输入格式验证**
   - 测试无效助记词
   - 验证错误提示

4. **基本功能验证**
   - 钱包地址显示
   - 余额查询功能

## 测试数据

位于 `e2e/utils/test-data.ts`，包含：

- 测试用助记词和私钥
- 测试密码
- 扩展页面路径
- 测试链配置

## Chrome 扩展测试配置

`e2e/fixtures/extension.ts` 提供了专门的测试夹具：

- 自动加载扩展到 Chrome
- 获取扩展 ID
- 配置适合扩展测试的浏览器参数

## 注意事项

1. **测试前确保扩展已构建**：运行 `npm run build`
2. **测试数据安全**：使用的是测试专用的助记词和私钥
3. **浏览器环境**：测试使用 Chromium，确保与 Chrome 扩展兼容
4. **并发测试**：CI 环境中禁用并发以避免扩展冲突

## 扩展测试用例

可以基于现有框架添加更多测试用例：

- DApp 交互测试
- 交易确认流程
- 余额查询
- 链切换功能
- 安全边界测试

## 故障排除

1. **扩展加载失败**：检查 `dist/` 目录是否存在且包含构建文件
2. **测试超时**：增加 Playwright 配置中的超时时间
3. **选择器失效**：更新测试用例中的页面选择器